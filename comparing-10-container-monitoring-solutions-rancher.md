# 容器领域的十大监控系统对比

容器监测环境有多种形态和大小。有些是开源的，而另一些则是商业性质的。有些可以借助平台一键部署（例如在Rancher容器管理平台的应用目录中一键部署这些监控应用），而另一些则需要手动配置。有些是通用的，有些是专门针对容器环境的。有些托管在公有云中，而另一些则需要在自己的集群主机上安装。

在本文中，我将对容器领域的10个监控解决方案进行全面的分析对比。监控解决方案的数量之多令人望而生畏。新的解决方案不断涌现，同时现有的解决方案不断发展。我没有深入研究每个解决方案，而是采取了high-level的对比方法。通过这种方法，读者可以“缩小列表”，并能针对自身需求进行更认真的评估，从而选出最适合的解决方案。

** 本文将介绍并对比的监控解决方案包括：**

* [原生Docker](https://docs.docker.com/engine/reference/commandline/stats/)
* [cAdvisor](https://github.com/google/cadvisor)
* [Scout](https://scoutapp.com/)
* [Pingdom](https://www.pingdom.com/)
* [Datadog](https://www.datadoghq.com/)
* [Sysdig](https://sysdig.com/)
* [Prometheus](https://prometheus.io/)
* [Heapster / GrafanaPingdom](https://github.com/kubernetes-retired/heapster)
* [ELK](https://www.elastic.co/cn/)
* [Sensu](https://sensu.io/)

我提出了一个对比监控解决方案的架构，并对每个解决方案进行了高级对比，然后通过讨论每个解决方案将如何与Rancher协同工作，从而更详细地讨论每个解决方案的细节。我还会在最后谈谈一些其它的监控解决方案，这些方案未被纳入本文的“十大”中，但你也可能遇到过。

## 对比架构
客观地对比监控解决方案面临的一个挑战是，解决方案的架构、功能、部署模型和成本可能会有很大的差异。一个解决方案可以从单个主机提取和绘制docker相关的数据，而另一个解决方案则可以从许多主机收集数据，测量应用程序响应时间，并在特定条件下发送自动警报。

在对比解决方案时，先确定一个对比架构，将会为后期的对比工作带来很大帮助。我有些武断地提出了如下图的对比架构，以大多数监控解决方案都具有的功能层,来作为我对比的基础。这个对比架构可以分为7层：

![seven_layers_of_docker_monitoring](https://github.com/anypm/anypm-kubernetes-tutorials-series/blob/master/monitering-images/seven_layers_of_docker_monitoring.png)

* **主机代理**——主机代理代表监控解决方案的“肢体”，它会从各种来源（如API和日志文件）提取时间序列数据。主机代理通常安装在每个集群主机上（无论是本地还是云端），并且它们通常被打包成Docker容器，以便部署和管理。

* **数据收集架构**——虽然单主机数据有时很有用，但管理员可能需要所有主机和应用程序的统一视图。监控解决方案通常具备一些机制来收集每个主机的数据，并将其保存在共享数据存储区中。

* **数据存储**——数据存储可能是传统的数据库，但更常见的一种形式是可伸缩的分布式数据库，由键值对组成的时间序列数据进行了优化。有些解决方案具有原生数据存储，而其他解决方案则使用的是开源的数据存储插件。

* **聚合引擎**——要存储来自数十个主机的原始数据，可能遇见的一大问题是数据量会变得过大。监控架构通常提供数据聚合功能，定期将原始数据转换为统一的度量标准(比如每小时或每日进行汇总)，清除不再需要的旧数据，或以某种方式重新分解数据，以支持预期的查询和分析。

* **过滤和分析**——一个监控解决方案就像是你从数据中获得的洞察力。不同的监控解决方案之间，筛选和分析的能力常常差别很大。有些解决方案仅支持以简单的时间序列图表的形式来进行一些预先打包的查询, 而另一些则具有可自定义的仪表板、嵌入式查询语言和复杂的分析功能。

* **可视化层**——监控工具通常具有可视化层，用户可以在其中与 web 界面进行交互以生成图表、制定查询以及在某些情况下定义警报条件。可视化层可能与筛选和分析功能紧密耦合, 也可能根据解决方案而与其分开。

* **告警和通知**——很少管理员有时间整天坐着、时刻关注监控图表。监控系统的另一个常见特性是告警子系统，如果达到或超过了预定义的阈值，可以向管理员发出通知。

除了解每个监控解决方案如何实现上述基本功能之外，如下方面也是用户在选择监控解决方案时应该注意与考量的：
* 解决方案的完整性
* 是否易于安装和配置
* 关于web用户界面的详细信息
* 是否能够将警报转发至外部服务
* 社区支持和参与程度（若该方案为开源项目）
* Rancher应用程序目录中的可用性
* 支持监控非容器环境和应用程序
* 原生Kubernetes支持（Pods、Services、Namespaces等）
* 可扩展性（API，其他接口）
* 部署模式（自主托管、云上托管）
* 成本

